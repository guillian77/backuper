<?= $varToJavascript('dirs', $dirs); ?>
<?= $varToJavascript('conf', $conf); ?>
<?= $varToJavascript('history', $history); ?>

<link href="/plugins/backuper/assets/app.css" rel="stylesheet" />
<script src="/plugins/backuper/assets/app.js" type= "module" defer></script>

<form id="backuper-form" action method="post">

    <div id="alert-container"></div>

    <!-- CONFIGURATION: Start -->
    <div class="container input-category">
        <h2 class="title">Configuration</h2>

        <div class="input-row checkbox">
            <label for="backup_enabled">Backup:</label>
            <input type="checkbox" name="conf[backup_enabled]" id="backup_enabled" class="backuper_conf">
            <p class="input-info">Backup is enabled when this checkbox is ticket.</p>
        </div>

        <div class="input-row checkbox">
            <label for="purge_enabled">Purge:</label>
            <input type="checkbox" name="conf[purge_enabled]" id="purge_enabled" class="backuper_conf">
            <p class="input-info">Purge is enabled when this checkbox is ticket.</p>
        </div>

        <div class="input-row checkbox">
            <label for="encrypt_enabled">Encrypt:</label>
            <input type="checkbox" name="conf[encrypt_enabled]" id="encrypt_enabled" class="backuper_conf">
            <p class="input-info">Archive encryption is enabled when this checkbox is ticket.</p>
        </div>

        <div class="input-row">
            <label for="encryption_key" class="label-block">Age public key:</label>
            <textarea name="conf[encryption_key]" id="encryption_key" placeholder="Your Age key" class="backuper_conf"></textarea>
            <p class="input-info">Only used when encryption is enabled.</p>
        </div>

        <div class="input-row">
            <label for="retention_days">Retention days:</label>
            <input type="number" name="conf[retention_days]" placeholder="7" id="retention_days" class="backuper_conf" />
            <p class="input-info">Retention in day(s) before purging old backups. Only if Purge enabled.</p>
        </div>

        <div class="input-row">
            <select name="conf[schedule_type]" class="backuper_conf">
                <option value="hourly">Hourly</option>
                <option value="daily">Daily</option>
                <option value="monthly">Monthly</option>
                <option value="yearly">Yearly</option>
            </select>
        </div>

        <button type="submit">Save</button>
    </div>
    <!-- CONFIGURATION: End -->

    <!-- TARGET list -->
    <div class="container input-category" id="target_dir_list">
        <h2 class="title">
            Target
            <span class="icon-u-plus btn add" title="Add one target directory." data-type="target"></span>
        </h2>

        <p class="input-info">A list of target where <b>Backup</b> will be saved.</p>

        <button type="submit">Save</button>
    </div>

    <!-- BACKUP list -->
    <div class="container input-category" id="backup_dir_list">
        <h2 class="title">
            To Backup
            <span class="icon-u-plus btn add" title="Add one backup directory." data-type="backup"></span>
        </h2>

        <p class="input-info">A list of directory to backup in <b>Target</b>.</p>

        <button type="submit">Save</button>
    </div>

    <!-- HEALTHCHECK: Start -->
    <div class="container">
        <h2 class="title">Healthcheck</h2>
        <p>Here you can have a quick look about backup history and health.</p>

        <br/>

        <table>
            <thead>
                <tr>
                    <th scope="col">ID</th>
                    <th scope="col">Start</th>
                    <th scope="col">End</th>
                    <th scope="col" class="with-title" title="How the backup has been trigger (cron, manual, web).">Type</th>
                    <th scope="col" class="with-title" title="Number of directories has been backup.">Backup</th>
                    <th scope="col" class="with-title" title="Number of backup purged.">Purged</th>
                    <th scope="col" class="with-title" title="Number of targets where directories was backups.">Target</th>
                    <th scope="col">Status</th>
                </tr>
            </thead>
            <tbody>
                <? foreach($history as $key => $historyLine): ?>
                    <tr>
                        <td><?= $historyLine->getId(); ?></td>
                        <td><?= $historyLine->getStartedAt()->format("Y-m-d H:m:i"); ?></td>
                        <td><?= $historyLine->getFinishedAt()->format("Y-m-d H:m:i"); ?></td>
                        <td><?= $historyLine->getRunType(); ?></td>
                        <td><?= $historyLine->getBackupNumber(); ?></td>
                        <td><?= $historyLine->getPurgedNumber(); ?></td>
                        <td><?= $historyLine->getTargetNumber(); ?></td>
                        <td><?= $historyLine->getStatus(); ?></td>
                    </tr>
                <? endforeach; ?>
            </tbody>
        </table>

    </div>
    <!-- HEALTHCHECK: End -->

    <input type="hidden" id="deleted_dirs" name="deleted_dirs" value="[]" />
</form>
